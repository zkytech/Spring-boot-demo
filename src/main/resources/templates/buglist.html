<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="/css/tables.css">
    <link rel="stylesheet" type="text/css" href="/css/buttons.css">
    <link rel="stylesheet" type="text/css" href="/css/no_border_padding_margin.css">
    <link rel="stylesheet" type="text/css" href="/css/box_window.css">
    <style>
        #page_index {
            border: hidden 0px;
            padding: 0px;
            margin: 0 auto;
        }

        #page_index tr, td {
            border: hidden 0px;
            margin: 0px;
            padding: 0px;
        }

        #page_index td {
            height: 35px;
            width: 30px;
        }

        .pbtn {
            height: 100%;
            width: 100%;
        }
        .pbtn:hover{
            cursor: pointer;
        }

        .bug_tr:hover{
            background-color: #e7e7e7;
        }

    </style>
    <title>漏洞列表</title>
</head>
<body style="height: max-content">
<table class="shown_table" style="width:90%;position: absolute;top: 20px;left: 20px;">
    <tr>
        <th style="width: 20%">名称</th>
        <th style="width: 15%">类型</th>
        <th style="width: 15%">等级</th>
        <th style="width: 20%">时间</th>
        <th style="width: 15%">详细信息</th>
        <th th:if="${identity} eq 1" style="width: 15%">操作</th>
        <!--管理员页面才会显示操作栏-->
    </tr>
    <!--遍历生成每一行数据-->
    <tr th:each="bug:${bugs}" class="bug_tr">
        <td th:text="${bug.bugname}"></td>
        <td th:text="${bug.bugtype}"></td>
        <td th:text="${bug.bugrank}"></td>
        <td th:text="${bug.date}"></td>
        <td>
            <button class="common_button" th:onclick="'javascript:show_info('+${bug.id}+')'">详细信息</button>
        </td>
        <td th:if="${identity} eq 1">
            <!--管理员页面才会显示操作栏-->
            <button type="button" class="common_button" th:onclick="'javascript:manage_bug('+${bug.id}+')'">操作</button>
        </td>
    </tr>
    <tr style="border-left: hidden;border-right: hidden;border-bottom: hidden;">
        <td colspan="7">
            <table id="page_index">
                <tr>
                    <td th:if="${page}&gt;1" style="height: 35px;width: 60px;">
                        <button type="button" class="pbtn" th:onclick="'javascript:change_page('+${page-1}+')'">上一页</button>
                    </td>
                    <td th:each="num:${pages}" style="height: 35px;width: 30px;border:0px" th:switch="${num}">
            <span th:case="${page}" th:text="${page}"
                  style="text-align: center;font-size: larger;width:100%;display:block;"></span>
                        <span th:case="${num}"><button class="pbtn" th:text="${num}" type="button"
                                                       th:onclick="'javascript:change_page('+${num}+')'"></button></span>
                    </td>
                    <td th:if="${page}&lt;${max_page}" style="height: 35px;width: 60px;">
                        <button th:with="next=(${page}+1)" type="button" class="pbtn"
                                th:onclick="'javascript:change_page('+${page+1}+')'">下一页
                        </button>
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>

<div id="box_window">
    <!--弹窗-->
    <div id="box_content">
        <div id="box_head">
            <!--弹窗头部-->
            <span style="text-align: center;font-size: large;width:available;display:block;float: left">漏洞详情</span>
            <span class="close">&times;</span>
        </div>
        <div id="box_body">
            <!--弹窗主体-->
            <iframe id="box_frame"></iframe>
        </div>
    </div>
</div>
<script>
    var box_window = document.getElementById("box_window");
    var span = document.getElementsByClassName("close")[0];
    var box_frame = document.getElementById("box_frame");

    function manage_bug(id) {
        window.parent.location.href = "/admin/managebug?id=" + id;
    }

    function change_page(pnum) {
        window.parent.document.getElementById("page").value = pnum;
        window.parent.document.getElementById("search_form").submit();
    }

    function show_info(id) {
        box_frame.setAttribute("src", "/showinfo?id=" + id);
        box_window.style.display = "block";
    }

    span.onclick = function () {
        box_window.style.display = "none";
    }


</script>
</body>
</html>